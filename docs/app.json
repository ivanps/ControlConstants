[{"name": "app.py", "content": "from shiny.express import input, render, ui\nfrom scipy.stats import norm\nfrom scipy.integrate import quad\nfrom scipy.special import gammaln\nimport numpy as np\n\nui.h1(\"Shewhart control charts constants\")\nui.input_numeric(\"n\", \"Select the group sample size:\", 5, min=2, max=100)\n\ndef compute_d2(n):\n    def integrand(x):\n        return 1 - (1 - norm.cdf(x)) ** n - (norm.cdf(x)) ** n\n\n    result, _ = quad(integrand, -np.inf, np.inf)\n    return result\n\ndef compute_c4(n):\n    # To avoid overflow, use gammaln() instead of gamma()\n    # Compute the exponential of the difference of the logs\n    gamma_ratio = np.exp(gammaln(n / 2) - gammaln((n - 1) / 2))\n    return np.sqrt(2 / (n - 1)) * gamma_ratio\n\n@render.code\ndef txt():\n    return f\"c4 = {compute_c4(input.n())}\\nd2 = {compute_d2(input.n())}\"\n", "type": "text"}]